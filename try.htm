<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeKids AI | Learn Programming the Fun Way!</title>
    <meta name="description" content="Learn programming with AI-powered flashcards designed for kids">
    <meta name="keywords" content="programming, learning, flashcards, OOP, Java, Python, kids, children">
    <meta name="author" content="CodeKids AI Team">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://codekids-ai.vercel.app">
    
    <!-- Open Graph (OG) Tags -->
    <meta property="og:title" content="CodeKids AI | Learn Programming the Fun Way!">
    <meta property="og:description" content="Learn programming with AI-powered flashcards designed for kids">
    <meta property="og:image" content="https://i.ibb.co/3yMXpZ71/codekids-ai-preview.jpg">
    <meta property="og:url" content="https://codekids-ai.vercel.app">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="CodeKids AI">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CodeKids AI | Learn Programming the Fun Way!">
    <meta name="twitter:description" content="Learn programming with AI-powered flashcards designed for kids">
    <meta name="twitter:image" content="https://codekids-ai.vercel.app/images/twitter-preview.jpg">
    <meta name="twitter:site" content="@codekidsai">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#FF6B6B">
    <meta name="msapplication-TileColor" content="#FF6B6B">
    <meta name="application-name" content="CodeKids AI">
    <meta name="apple-mobile-web-app-title" content="CodeKids AI">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Fredoka', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #FF9A8B, #FF6B6B, #FFC837);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        #three-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 3px solid #FF9A8B;
            margin-bottom: 100px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 3rem;
            font-weight: 700;
            color: #FF6B6B;
            text-shadow: 2px 2px 0px #FFC837;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.2rem;
            color: #FF6B6B;
            font-weight: 600;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #FF6B6B;
            font-size: 1.2rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            font-size: 1.1rem;
            font-family: 'Fredoka', sans-serif;
            backdrop-filter: blur(5px);
            border: 2px solid #FF9A8B;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.4);
            border-color: #FF6B6B;
        }

        input::placeholder, textarea::placeholder {
            color: #FF9A8B;
        }

        button {
            background: linear-gradient(45deg, #FF6B6B, #FF9A8B);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 15px;
            margin-top: 15px;
            font-family: 'Fredoka', sans-serif;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
            background: linear-gradient(45deg, #FF9A8B, #FF6B6B);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
        }

        .loading-text {
            font-size: 2.5rem;
            margin-bottom: 30px;
            animation: pulse 1.5s infinite;
            text-align: center;
            color: #FF6B6B;
            font-weight: 600;
        }

        .loading-credit {
            font-size: 1.4rem;
            margin-top: 15px;
            opacity: 0;
            animation: fadeIn 1s forwards;
            animation-delay: 0.5s;
            color: #FF9A8B;
        }

        .loading-credit:nth-child(3) {
            animation-delay: 1s;
        }

        @keyframes pulse {
            0% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.6; transform: scale(1); }
        }

        .question-container {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 25px;
            border: 3px solid #FF9A8B;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
            border: 2px solid #FF9A8B;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #FF6B6B, #FFC837);
            width: 0%;
            transition: width 0.5s ease;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #FF9A8B;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .history-item button {
            padding: 10px 15px;
            font-size: 1rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 107, 107, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px 25px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            border: 2px solid rgba(255, 255, 255, 0.3);
            font-size: 1.1rem;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: rgba(255, 59, 48, 0.9);
        }

        .generating-animation {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
        }

        .generating-text {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-align: center;
            color: #FF6B6B;
            font-weight: 600;
        }

        .lottie-container {
            width: 250px;
            height: 250px;
            margin: 20px 0;
        }

        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            padding: 15px;
            text-align: center;
            color: #FF6B6B;
            font-size: 1rem;
            border-top: 3px solid #FF9A8B;
            z-index: 100;
            font-weight: 600;
        }

        .option-container {
            margin-top: 20px;
        }

        .option {
            display: block;
            background: rgba(255, 255, 255, 0.8);
            border: 3px solid #FF9A8B;
            border-radius: 20px;
            padding: 18px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            font-size: 1.1rem;
        }

        .option:hover {
            background: rgba(255, 154, 139, 0.3);
            border-color: #FF6B6B;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }

        .option.selected {
            background: rgba(255, 107, 107, 0.3);
            border-color: #FF6B6B;
            transform: scale(1.02);
        }

        .option input[type="radio"] {
            display: none;
        }

        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #FF9A8B, #FF6B6B, #FFC837);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .splash-content {
            text-align: center;
            max-width: 700px;
            padding: 40px;
        }

        .splash-title {
            font-size: 3.5rem;
            margin-bottom: 25px;
            color: white;
            text-shadow: 2px 2px 0px #FF6B6B;
            font-weight: 700;
        }

        .splash-subtitle {
            font-size: 1.8rem;
            margin-bottom: 40px;
            color: white;
            font-weight: 500;
        }

        .splash-animation {
            width: 350px;
            height: 350px;
            margin: 20px auto;
        }

        .splash-footer {
            margin-top: 40px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .splash-continue {
            margin-top: 40px;
            padding: 18px 40px;
            font-size: 1.3rem;
            background: white;
            color: #FF6B6B;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .splash-continue:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Language Selection Styles */
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .language-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 25px;
            border: 3px solid #FF9A8B;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: #333;
        }

        .language-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.3);
            border-color: #FF6B6B;
        }

        .language-card.selected {
            background: rgba(255, 107, 107, 0.3);
            border-color: #FF6B6B;
            transform: scale(1.05);
        }

        .language-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .language-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #FF6B6B;
        }

        .language-description {
            font-size: 1rem;
            color: #666;
        }

        /* Flashcard Styles */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            height: 450px;
            margin: 25px 0;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 3px solid #FF9A8B;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
        }

        .flashcard-back {
            transform: rotateY(180deg);
        }

        .flashcard-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #FF6B6B;
            font-weight: 600;
        }

        .flashcard-content {
            font-size: 1.3rem;
            line-height: 1.6;
            color: #333;
        }

        .flashcard-code {
            background: rgba(255, 154, 139, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-align: left;
            overflow-x: auto;
            border: 2px dashed #FF9A8B;
        }

        .flashcard-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        .difficulty-indicator {
            display: flex;
            align-items: center;
            margin-top: 15px;
            justify-content: center;
        }

        .difficulty-label {
            font-size: 1.2rem;
            margin-right: 10px;
            color: #FF6B6B;
            font-weight: 600;
        }

        .difficulty-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 5px;
        }

        .difficulty-easy { background-color: #4CAF50; }
        .difficulty-medium { background-color: #FFC837; }
        .difficulty-hard { background-color: #FF6B6B; }

        /* Chapter Progress Styles */
        .chapter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .chapter-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 25px;
            border: 3px solid #FF9A8B;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
        }

        .chapter-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.3);
            border-color: #FF6B6B;
        }

        .chapter-card.completed {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4CAF50;
        }

        .chapter-card.current {
            background: rgba(255, 107, 107, 0.2);
            border-color: #FF6B6B;
        }

        .chapter-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #FF6B6B;
            font-weight: 600;
        }

        .chapter-description {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }

        .chapter-progress {
            height: 10px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid #FF9A8B;
        }

        .chapter-progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #FF6B6B, #FFC837);
            width: 0%;
            transition: width 0.5s ease;
        }

        .chapter-stats {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            color: #666;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 25px;
            border: 3px solid #FF9A8B;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .dashboard-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: #FF6B6B;
            font-weight: 600;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px dashed rgba(255, 154, 139, 0.5);
        }

        .stat-label {
            color: #666;
            font-size: 1.1rem;
        }

        .stat-value {
            font-weight: 600;
            color: #FF6B6B;
            font-size: 1.2rem;
        }

        .profile-btn {
            position: fixed;
            bottom: 120px;
            right: 20px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF6B6B, #FF9A8B);
            color: white;
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
            z-index: 99;
            transition: all 0.3s ease;
        }

        .profile-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
        }

        /* Tutorial Section Styles */
        .tutorial-section {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px;
        }

        .tutorial-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .tutorial-header h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #FF6B6B;
            font-weight: 700;
        }

        .tutorial-header p {
            font-size: 1.4rem;
            color: #666;
        }

        .tutorial-steps {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .tutorial-step {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            border: 3px solid #FF9A8B;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .step-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #FF6B6B, #FF9A8B);
            border-radius: 50%;
            text-align: center;
            line-height: 50px;
            font-weight: 700;
            margin-bottom: 20px;
            color: white;
            font-size: 1.5rem;
        }

        .step-content h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #FF6B6B;
            font-weight: 600;
        }

        .step-content p {
            margin-bottom: 20px;
            line-height: 1.6;
            color: #333;
            font-size: 1.2rem;
        }

        .step-content ul {
            margin-left: 25px;
            margin-bottom: 20px;
        }

        .step-content li {
            margin-bottom: 10px;
            color: #333;
            font-size: 1.2rem;
        }

        .tutorial-actions {
            text-align: center;
            margin-top: 40px;
        }

        .tutorial-note {
            background: rgba(255, 154, 139, 0.2);
            border-left: 5px solid #FF6B6B;
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .tutorial-note p {
            margin: 0;
            color: #333;
            font-size: 1.2rem;
        }

        /* Quiz Styles */
        .quiz-container {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            border: 3px solid #FF9A8B;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            color: #333;
        }

        .quiz-question {
            font-size: 1.6rem;
            margin-bottom: 25px;
            color: #FF6B6B;
            font-weight: 600;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .quiz-option {
            background: rgba(255, 255, 255, 0.8);
            border: 3px solid #FF9A8B;
            border-radius: 20px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            font-size: 1.2rem;
        }

        .quiz-option:hover {
            background: rgba(255, 154, 139, 0.3);
            border-color: #FF6B6B;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }

        .quiz-option.selected {
            background: rgba(255, 107, 107, 0.3);
            border-color: #FF6B6B;
            transform: scale(1.02);
        }

        .quiz-option.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }

        .quiz-option.incorrect {
            background: rgba(255, 59, 48, 0.3);
            border-color: #FF3B30;
        }

        .quiz-feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            background: rgba(255, 154, 139, 0.2);
            border-left: 5px solid #FF6B6B;
            font-size: 1.2rem;
        }

        .quiz-score {
            text-align: center;
            font-size: 2rem;
            margin: 25px 0;
            color: #FF6B6B;
            font-weight: 700;
        }

        /* Achievement Badge */
        .achievement-badge {
            display: inline-block;
            background: linear-gradient(45deg, #FFC837, #FF6B6B);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        /* Character Avatar */
        .character-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #FF6B6B, #FF9A8B);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 50px;
            margin: 0 auto 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Fun Elements */
        .fun-decoration {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(255, 200, 55, 0.5);
            border-radius: 50%;
            z-index: -1;
        }

        .fun-decoration:nth-child(1) {
            top: 10%;
            left: 5%;
            width: 80px;
            height: 80px;
        }

        .fun-decoration:nth-child(2) {
            top: 20%;
            right: 10%;
            width: 60px;
            height: 60px;
        }

        .fun-decoration:nth-child(3) {
            bottom: 15%;
            left: 8%;
            width: 70px;
            height: 70px;
        }

        .fun-decoration:nth-child(4) {
            bottom: 25%;
            right: 5%;
            width: 90px;
            height: 90px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            button {
                width: 100%;
                margin-right: 0;
            }
            
            .splash-title {
                font-size: 2.8rem;
            }
            
            .splash-subtitle {
                font-size: 1.5rem;
            }

            .tutorial-header h2 {
                font-size: 2.2rem;
            }

            .step-content h3 {
                font-size: 1.5rem;
            }

            .language-grid {
                grid-template-columns: 1fr;
            }

            .chapter-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Fun Decorations -->
    <div class="fun-decoration"></div>
    <div class="fun-decoration"></div>
    <div class="fun-decoration"></div>
    <div class="fun-decoration"></div>
    
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <h1 class="splash-title">üöÄ CodeKids AI üöÄ</h1>
            <p class="splash-subtitle">Learn programming the fun way with your AI friend!</p>
            <div class="splash-animation">
                <lottie-player src="https://assets4.lottiefiles.com/packages/lf20_DMgKk1.json" background="transparent" speed="1" loop autoplay></lottie-player>
            </div>
            <div class="splash-footer">
                <p>üéÆ Play, Learn, and Code! üéÆ</p>
                <p>üåü Your adventure starts here! üåü</p>
            </div>
            <button class="splash-continue" id="continue-to-app">Let's Start! üéâ</button>
        </div>
    </div>

    <div id="three-background"></div>
    
    <div class="container">
        <h1>üöÄ CodeKids AI üöÄ</h1>
        
        <!-- Tutorial Section -->
        <div id="tutorial-section" class="section">
            <div class="tutorial-section">
                <div class="tutorial-header">
                    <h2>Welcome to CodeKids AI! üéâ</h2>
                    <p>Let's get you started on your coding adventure!</p>
                </div>
                
                <div class="tutorial-steps">
                    <div class="tutorial-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Create Your Adventure Profile ü¶∏</h3>
                            <p>Your profile is your special space where we'll track all your amazing coding progress!</p>
                            <div class="tutorial-note">
                                <p><strong>Fun Fact:</strong> All your data stays safe on your device, just like a secret diary!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tutorial-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Choose Your Coding Language üåç</h3>
                            <p>Pick a programming language to start your journey. Each one is like a different superpower!</p>
                            <ul>
                                <li>‚òï Java - Build amazing apps and games!</li>
                                <li>üêç Python - Perfect for beginners and super fun!</li>
                                <li>‚öôÔ∏è C++ - Create fast and powerful programs!</li>
                                <li>üåê JavaScript - Make websites come alive!</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="tutorial-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Connect Your AI Helper ü§ñ</h3>
                            <p>Your AI friend will help create fun learning adventures just for you!</p>
                            <ul>
                                <li>Get your free magic key from Google AI Studio</li>
                                <li>Enter it in the setup screen</li>
                                <li>Start your amazing learning journey!</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="tutorial-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Start Your Learning Adventure üéÆ</h3>
                            <p>Your AI friend watches how you learn and creates special challenges just for you:</p>
                            <ul>
                                <li>üé¥ Fun flashcards with cool pictures</li>
                                <li>üß© Puzzles based on what you need help with</li>
                                <li>üìä Track your progress and earn badges</li>
                                <li>üéØ Smart reviews to help you remember</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="tutorial-actions">
                    <button id="got-it-btn" class="splash-continue">I'm Ready! Let's Go! üöÄ</button>
                </div>
            </div>
        </div>
        
        <!-- Profile Creation Section -->
        <div id="profile-section" class="section">
            <h2>Create Your Adventure Profile ü¶∏</h2>
            <div class="form-group">
                <label for="user-name">What's your name, young coder?</label>
                <input type="text" id="user-name" placeholder="Your awesome name">
            </div>
            <div class="form-group">
                <label for="learning-goal">What's your coding adventure goal?</label>
                <select id="learning-goal">
                    <option value="beginner">I'm just starting my coding journey! üå±</option>
                    <option value="student">I want to be a coding student! üéì</option>
                    <option value="professional">I want to build cool things! üíº</option>
                    <option value="hobby">Coding is my super fun hobby! üéÆ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="session-length">How long do you want to play and learn?</label>
                <select id="session-length">
                    <option value="15">15 minutes - Quick adventure! ‚ö°</option>
                    <option value="30">30 minutes - Perfect learning time! üéØ</option>
                    <option value="45">45 minutes - Deep dive! üåä</option>
                    <option value="60">60 minutes - Super coder mode! üí™</option>
                </select>
            </div>
            <button id="create-profile-btn">Create My Profile! üéâ</button>
            <div id="profile-status"></div>
        </div>
        
        <!-- Language Selection Section -->
        <div id="language-selection-section" class="section">
            <h2>Choose Your Coding Superpower! üåü</h2>
            <p>Each programming language is like a different superpower. Which one do you want to learn?</p>
            <div class="language-grid">
                <div class="language-card selected" data-language="java">
                    <div class="language-icon">‚òï</div>
                    <div class="language-name">Java</div>
                    <div class="language-description">Build amazing apps and games!</div>
                </div>
                <div class="language-card" data-language="python">
                    <div class="language-icon">üêç</div>
                    <div class="language-name">Python</div>
                    <div class="language-description">Perfect for beginners and super fun!</div>
                </div>
                <div class="language-card" data-language="cpp">
                    <div class="language-icon">‚öôÔ∏è</div>
                    <div class="language-name">C++</div>
                    <div class="language-description">Create fast and powerful programs!</div>
                </div>
                <div class="language-card" data-language="javascript">
                    <div class="language-icon">üåê</div>
                    <div class="language-name">JavaScript</div>
                    <div class="language-description">Make websites come alive!</div>
                </div>
            </div>
            <button id="continue-to-api" style="margin-top: 25px;">Next Step! üöÄ</button>
        </div>
        
        <!-- API Key Section -->
        <div id="api-key-section" class="section">
            <h2>Connect Your AI Helper! ü§ñ</h2>
            <div class="form-group">
                <label for="api-key">Enter your Gemini API Key:</label>
                <input type="password" id="api-key" placeholder="Your special AI magic key">
            </div>
            <button id="save-api-key">Save My AI Key! üîë</button>
            <div id="api-status"></div>
            <div style="margin-top: 25px;">
                <button id="show-tutorial-btn" style="background: rgba(255, 154, 139, 0.3);">Need Help? Show Tutorial üìö</button>
            </div>
        </div>
        
        <!-- Loading Screen -->
        <div id="loading-section" class="section">
            <div class="loading-screen">
                <div class="loading-text">AI is preparing your learning adventure...</div>
                <div class="loading-credit">üéÆ Creating fun challenges just for you!</div>
                <div class="loading-credit">üåü Making your special learning path!</div>
                <div class="lottie-container">
                    <lottie-player src="https://assets9.lottiefiles.com/packages/lf20_DMgKk1.json" background="transparent" speed="1" loop autoplay></lottie-player>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section">
            <h2>Welcome back, <span id="user-display-name"></span>! üéâ</h2>
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="dashboard-title">Your Learning Adventure üìä</div>
                    <div class="stat-item">
                        <span class="stat-label">Current Mission:</span>
                        <span class="stat-value" id="current-chapter">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Completed Missions:</span>
                        <span class="stat-value" id="completed-chapters">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Flashcards Collected:</span>
                        <span class="stat-value" id="total-flashcards">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Skills Mastered:</span>
                        <span class="stat-value" id="mastered-concepts">0</span>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="dashboard-title">Your Learning Superpowers ü¶∏‚Äç‚ôÇÔ∏è</div>
                    <div class="stat-item">
                        <span class="stat-label">Average Time:</span>
                        <span class="stat-value" id="avg-time">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Best Learning Time:</span>
                        <span class="stat-value" id="best-time">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Memory Power:</span>
                        <span class="stat-value" id="retention-rate">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Learning Speed:</span>
                        <span class="stat-value" id="learning-velocity">-</span>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="dashboard-title">AI Friend's Tips ü§ñ</div>
                    <div id="ai-recommendations">
                        <p>ü§î Your AI friend is thinking of special tips for you...</p>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button id="continue-learning-btn">Continue Learning! üéÆ</button>
                <button id="view-chapters-btn">View All Missions! üó∫Ô∏è</button>
            </div>
        </div>
        
        <!-- Chapters Section -->
        <div id="chapters-section" class="section">
            <h2>Your Coding Missions! üó∫Ô∏è</h2>
            <div class="chapter-grid" id="chapter-grid">
                <!-- Chapters will be populated here -->
            </div>
            <div style="text-align: center; margin-top: 40px;">
                <button id="back-to-dashboard-btn">Back to Dashboard! üè†</button>
            </div>
        </div>
        
        <!-- Flashcard Section -->
        <div id="flashcard-section" class="section">
            <h2>Learning Flashcards! üé¥</h2>
            <div class="flashcard-container">
                <div class="flashcard" id="flashcard">
                    <div class="flashcard-face flashcard-front">
                        <div class="flashcard-title" id="flashcard-title">Click to reveal! üëÜ</div>
                        <div class="flashcard-content" id="flashcard-front-content">
                            Loading your fun learning card...
                        </div>
                    </div>
                    <div class="flashcard-face flashcard-back">
                        <div class="flashcard-title">Answer! üéâ</div>
                        <div class="flashcard-content" id="flashcard-back-content">
                            Loading the surprise answer...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flashcard-controls">
                <button id="prev-flashcard-btn">Previous Card ‚¨ÖÔ∏è</button>
                <button id="flip-flashcard-btn">Flip Card! üîÑ</button>
                <button id="next-flashcard-btn">Next Card ‚û°Ô∏è</button>
            </div>
            
            <div class="difficulty-indicator">
                <span class="difficulty-label">How hard was this?</span>
                <div class="difficulty-dot difficulty-easy"></div>
                <div class="difficulty-dot difficulty-medium"></div>
                <div class="difficulty-dot difficulty-hard"></div>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button id="mark-easy-btn">Too Easy! üòé</button>
                <button id="mark-medium-btn">Just Right! üòä</button>
                <button id="mark-hard-btn">A Bit Hard! ü§î</button>
                <button id="complete-chapter-btn">Mission Complete! üèÜ</button>
            </div>
        </div>
        
        <!-- Quiz Section -->
        <div id="quiz-section" class="section">
            <h2>Mission Quiz! üß©</h2>
            <div id="quiz-container">
                <!-- Quiz questions will be populated here -->
            </div>
            <div id="quiz-score" class="quiz-score" style="display: none;">
                Your Score: <span id="score-value">0</span>%
            </div>
            <div style="text-align: center; margin-top: 40px;">
                <button id="submit-quiz-btn" style="display: none;">Submit Quiz! üì§</button>
                <button id="next-chapter-btn" style="display: none;">Next Mission! üöÄ</button>
                <button id="back-to-chapters-btn">Back to Missions! üó∫Ô∏è</button>
            </div>
        </div>
        
        <!-- Profile Section -->
        <div id="profile-view-section" class="section">
            <h2>Your Adventure Profile! ü¶∏</h2>
            <div class="dashboard-card">
                <div class="dashboard-title">Your Hero Info ü¶∏‚Äç‚ôÇÔ∏è</div>
                <div class="stat-item">
                    <span class="stat-label">Hero Name:</span>
                    <span class="stat-value" id="profile-name">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Hero ID:</span>
                    <span class="stat-value" id="profile-key">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Adventure Started:</span>
                    <span class="stat-value" id="profile-created">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Coding Superpower:</span>
                    <span class="stat-value" id="profile-language">-</span>
                </div>
            </div>
            
            <div class="dashboard-card" style="margin-top: 25px;">
                <div class="dashboard-title">Your Achievements! üèÜ</div>
                <div class="stat-item">
                    <span class="stat-label">Total Learning Time:</span>
                    <span class="stat-value" id="total-study-time">0 minutes</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Sessions Completed:</span>
                    <span class="stat-value" id="sessions-completed">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Average Quiz Score:</span>
                    <span class="stat-value" id="avg-quiz-score">0%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Current Streak:</span>
                    <span class="stat-value" id="current-streak">0 days</span>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button id="export-data-btn">Save My Progress! üíæ</button>
                <button id="reset-progress-btn" style="background: rgba(255, 59, 48, 0.7);">Reset Adventure! üîÑ</button>
                <button id="back-to-dashboard-from-profile-btn">Back to Dashboard! üè†</button>
            </div>
        </div>
    </div>
    
    <footer>
        üöÄ CodeKids AI | Learn Programming the Fun Way! üöÄ
    </footer>
    
    <button class="profile-btn" id="profile-toggle" title="View Profile">üë§</button>
    
    <div id="notification" class="notification"></div>

    <script>
        // Application State
        const appState = {
            // User Profile
            userName: '',
            userKey: '',
            createdDate: '',
            learningGoal: '',
            sessionLength: 30,
            selectedLanguage: 'java',
            
            // API Configuration
            apiKey: '',
            
            // Learning Progress
            currentChapter: 1,
            completedChapters: [],
            totalFlashcards: 0,
            masteredConcepts: 0,
            
            // Learning Patterns
            flashcardData: {},
            quizScores: {},
            timeSpent: {},
            learningPatterns: {
                averageTimePerFlashcard: 0,
                peakPerformanceTime: '',
                difficultConcepts: [],
                preferredLearningStyle: '',
                retentionRate: 0,
                commonMistakes: []
            },
            
            // AI Recommendations
            aiRecommendations: {
                nextFocusAreas: [],
                suggestedReviewTopics: [],
                adaptedContent: false,
                personalizedHints: false,
                difficultyAdjustment: 0
            },
            
            // Current Session
            currentFlashcardIndex: 0,
            currentFlashcards: [],
            currentQuiz: [],
            currentQuizAnswers: [],
            sessionStartTime: null,
            
            // Chapter Content
            chapters: {},
            
            // UI State
            hasSeenTutorial: false,
            currentSection: 'splash'
        };

        // Programming Language Content Structure - Kid-Friendly Version
        const languageContent = {
            java: {
                name: 'Java',
                icon: '‚òï',
                chapters: [
                    {
                        id: 1,
                        title: 'What is Object-Oriented Programming? üß©',
                        description: 'Learn how to build with programming blocks!',
                        topics: [
                            'What is OOP? Like building with LEGOs!',
                            'OOP vs Regular Programming',
                            'Why OOP is super cool!',
                            'Real-world examples of OOP'
                        ]
                    },
                    {
                        id: 2,
                        title: 'Classes and Objects üèóÔ∏è',
                        description: 'Create your own programming building blocks!',
                        topics: [
                            'What is a class? Like a blueprint!',
                            'Creating objects from classes',
                            'The magic "new" keyword',
                            'Class vs Object - what\'s the difference?'
                        ]
                    },
                    {
                        id: 3,
                        title: 'Encapsulation - Secret Boxes! üì¶',
                        description: 'Keep your code safe and organized!',
                        topics: [
                            'What is encapsulation? Like a treasure chest!',
                            'Public and Private - who can see what?',
                            'Getters and Setters - special doors!',
                            'Why secrets are important in code'
                        ]
                    },
                    {
                        id: 4,
                        title: 'Inheritance - Superpowers! ü¶∏‚Äç‚ôÇÔ∏è',
                        description: 'Pass on your coding superpowers!',
                        topics: [
                            'What is inheritance? Like family traits!',
                            'Parent and Child classes',
                            'The "extends" magic word',
                            'Method overriding - changing superpowers!'
                        ]
                    },
                    {
                        id: 5,
                        title: 'Polymorphism - Shape Shifters! üîÑ',
                        description: 'One thing, many forms!',
                        topics: [
                            'What is polymorphism? Like a transformer!',
                            'Method overloading - same name, different jobs',
                            'Dynamic binding - magic at runtime!',
                            'Real-world examples of polymorphism'
                        ]
                    },
                    {
                        id: 6,
                        title: 'Abstraction - Magic Tricks! üé©',
                        description: 'Hide the complicated stuff!',
                        topics: [
                            'What is abstraction? Like a magic show!',
                            'Abstract classes - special blueprints',
                            'Interfaces - contracts for code',
                            'Why hiding details is super helpful'
                        ]
                    },
                    {
                        id: 7,
                        title: 'Constructors - Building Makers! üèóÔ∏è',
                        description: 'Create objects the right way!',
                        topics: [
                            'What is a constructor? Like a factory!',
                            'Default constructors - automatic builders',
                            'Parameterized constructors - custom builders',
                            'The "this" magic word'
                        ]
                    },
                    {
                        id: 8,
                        title: 'Static Members - Class Powers! ‚ö°',
                        description: 'Powers that belong to everyone!',
                        topics: [
                            'Static variables - shared treasures',
                            'Static methods - class powers',
                            'Static blocks - special startup code',
                            'Static vs Non-static - what\'s the difference?'
                        ]
                    },
                    {
                        id: 9,
                        title: 'The Super Keyword - Parent Powers! üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                        description: 'Connect with your parent class!',
                        topics: [
                            'Super with variables - parent treasures',
                            'Super with methods - parent powers',
                            'Super with constructors - parent builders',
                            'Super vs This - family vs self'
                        ]
                    },
                    {
                        id: 10,
                        title: 'Packages - Code Folders! üìÅ',
                        description: 'Organize your code like a pro!',
                        topics: [
                            'What are packages? Like folders for code!',
                            'Package declaration - naming your folder',
                            'Import statement - bringing in friends',
                            'Built-in packages - ready-made tools'
                        ]
                    },
                    {
                        id: 11,
                        title: 'Advanced OOP Magic! ü™Ñ',
                        description: 'Become an OOP wizard!',
                        topics: [
                            'High modularity - building with blocks',
                            'Code reusability - use it again!',
                            'Layers of abstraction - hiding complexity',
                            'Message passing - code talking to code'
                        ]
                    },
                    {
                        id: 12,
                        title: 'OOP Best Practices - Pro Tips! üí°',
                        description: 'Code like a programming superhero!',
                        topics: [
                            'SOLID principles - golden rules',
                            'Design patterns - secret recipes',
                            'Code organization - keeping it tidy',
                            'Common mistakes to avoid'
                        ]
                    }
                ]
            },
            python: {
                name: 'Python',
                icon: 'üêç',
                chapters: [
                    {
                        id: 1,
                        title: 'Python OOP Adventure! üêç',
                        description: 'Start your Python object journey!',
                        topics: [
                            'Python OOP basics',
                            'Why Python OOP is super fun',
                            'Python vs other languages',
                            'Real-world Python adventures'
                        ]
                    },
                    {
                        id: 2,
                        title: 'Python Classes and Objects! üèóÔ∏è',
                        description: 'Build with Python blocks!',
                        topics: [
                            'Class definition in Python',
                            'Creating Python objects',
                            'The magic __init__ method',
                            'Instance variables in Python'
                        ]
                    },
                    {
                        id: 3,
                        title: 'Python Encapsulation! üì¶',
                        description: 'Keep your Python code safe!',
                        topics: [
                            'Python access levels',
                            'Name mangling magic',
                            'Property decorators',
                            'Python getters and setters'
                        ]
                    },
                    {
                        id: 4,
                        title: 'Python Inheritance! ü¶∏‚Äç‚ôÇÔ∏è',
                        description: 'Python family powers!',
                        topics: [
                            'Single inheritance in Python',
                            'Multiple inheritance - many parents!',
                            'Method Resolution Order',
                            'The Super() function'
                        ]
                    },
                    {
                        id: 5,
                        title: 'Python Polymorphism! üîÑ',
                        description: 'Python shape shifters!',
                        topics: [
                            'Duck typing in Python',
                            'Method overriding',
                            'Operator overloading',
                            'Abstract base classes'
                        ]
                    },
                    {
                        id: 6,
                        title: 'Python Abstraction! üé©',
                        description: 'Python magic tricks!',
                        topics: [
                            'Abstract classes in Python',
                            'The ABC module',
                            'Abstract methods',
                            'Concrete implementations'
                        ]
                    }
                ]
            },
            cpp: {
                name: 'C++',
                icon: '‚öôÔ∏è',
                chapters: [
                    {
                        id: 1,
                        title: 'C++ OOP Power! ‚ö°',
                        description: 'Unleash C++ object magic!',
                        topics: [
                            'C++ OOP fundamentals',
                            'C vs C++ OOP',
                            'Why C++ OOP is powerful',
                            'C++ OOP applications'
                        ]
                    },
                    {
                        id: 2,
                        title: 'C++ Classes and Objects! üèóÔ∏è',
                        description: 'Build with C++ blocks!',
                        topics: [
                            'Class declaration in C++',
                            'Object definition',
                            'Member functions',
                            'Access specifiers'
                        ]
                    },
                    {
                        id: 3,
                        title: 'C++ Encapsulation! üì¶',
                        description: 'C++ secret boxes!',
                        topics: [
                            'Private members in C++',
                            'Public interface',
                            'Protected members',
                            'Friend functions'
                        ]
                    },
                    {
                        id: 4,
                        title: 'C++ Inheritance! ü¶∏‚Äç‚ôÇÔ∏è',
                        description: 'C++ family powers!',
                        topics: [
                            'Single inheritance',
                            'Multiple inheritance',
                            'Multilevel inheritance',
                            'Hierarchical inheritance'
                        ]
                    },
                    {
                        id: 5,
                        title: 'C++ Polymorphism! üîÑ',
                        description: 'C++ shape shifters!',
                        topics: [
                            'Function overloading',
                            'Operator overloading',
                            'Virtual functions',
                            'Pure virtual functions'
                        ]
                    },
                    {
                        id: 6,
                        title: 'C++ Abstraction! üé©',
                        description: 'C++ magic tricks!',
                        topics: [
                            'Abstract classes in C++',
                            'Pure virtual functions',
                            'Interfaces in C++',
                            'Implementation strategies'
                        ]
                    }
                ]
            },
            javascript: {
                name: 'JavaScript',
                icon: 'üåê',
                chapters: [
                    {
                        id: 1,
                        title: 'JavaScript OOP Adventure! üåê',
                        description: 'Web object magic!',
                        topics: [
                            'JavaScript OOP basics',
                            'Prototypal inheritance',
                            'ES6 classes',
                            'OOP patterns in JS'
                        ]
                    },
                    {
                        id: 2,
                        title: 'JS Objects and Prototypes! üèóÔ∏è',
                        description: 'Build with web blocks!',
                        topics: [
                            'Object creation in JS',
                            'Prototype chain',
                            'Constructor functions',
                            'Object.create()'
                        ]
                    },
                    {
                        id: 3,
                        title: 'ES6 Classes! üéì',
                        description: 'Modern JavaScript OOP!',
                        topics: [
                            'Class declaration',
                            'Constructor',
                            'Methods',
                            'Static members'
                        ]
                    },
                    {
                        id: 4,
                        title: 'JS Inheritance! ü¶∏‚Äç‚ôÇÔ∏è',
                        description: 'Web family powers!',
                        topics: [
                            'Prototype inheritance',
                            'Class inheritance',
                            'Extends keyword',
                            'Super keyword'
                        ]
                    },
                    {
                        id: 5,
                        title: 'JS Polymorphism! üîÑ',
                        description: 'Web shape shifters!',
                        topics: [
                            'Method overriding',
                            'Duck typing',
                            'Dynamic dispatch',
                            'Function polymorphism'
                        ]
                    },
                    {
                        id: 6,
                        title: 'JS Encapsulation! üì¶',
                        description: 'Web secret boxes!',
                        topics: [
                            'Private fields',
                            'Getters and setters',
                            'Closures',
                            'Module pattern'
                        ]
                    }
                ]
            }
        };

        // DOM Elements
        const sections = {
            splash: document.getElementById('splash-screen'),
            tutorial: document.getElementById('tutorial-section'),
            profile: document.getElementById('profile-section'),
            languageSelection: document.getElementById('language-selection-section'),
            apiKey: document.getElementById('api-key-section'),
            loading: document.getElementById('loading-section'),
            dashboard: document.getElementById('dashboard-section'),
            chapters: document.getElementById('chapters-section'),
            flashcard: document.getElementById('flashcard-section'),
            quiz: document.getElementById('quiz-section'),
            profileView: document.getElementById('profile-view-section')
        };

        const elements = {
            // Splash Screen
            continueToApp: document.getElementById('continue-to-app'),
            
            // Tutorial
            gotItBtn: document.getElementById('got-it-btn'),
            showTutorialBtn: document.getElementById('show-tutorial-btn'),
            
            // Profile Creation
            userName: document.getElementById('user-name'),
            learningGoal: document.getElementById('learning-goal'),
            sessionLength: document.getElementById('session-length'),
            createProfileBtn: document.getElementById('create-profile-btn'),
            profileStatus: document.getElementById('profile-status'),
            
            // Language Selection
            languageCards: document.querySelectorAll('.language-card'),
            continueToApi: document.getElementById('continue-to-api'),
            
            // API Key
            apiKeyInput: document.getElementById('api-key'),
            saveApiKeyBtn: document.getElementById('save-api-key'),
            apiStatus: document.getElementById('api-status'),
            
            // Dashboard
            userDisplayName: document.getElementById('user-display-name'),
            currentChapter: document.getElementById('current-chapter'),
            completedChapters: document.getElementById('completed-chapters'),
            totalFlashcards: document.getElementById('total-flashcards'),
            masteredConcepts: document.getElementById('mastered-concepts'),
            avgTime: document.getElementById('avg-time'),
            bestTime: document.getElementById('best-time'),
            retentionRate: document.getElementById('retention-rate'),
            learningVelocity: document.getElementById('learning-velocity'),
            aiRecommendations: document.getElementById('ai-recommendations'),
            continueLearningBtn: document.getElementById('continue-learning-btn'),
            viewChaptersBtn: document.getElementById('view-chapters-btn'),
            
            // Chapters
            chapterGrid: document.getElementById('chapter-grid'),
            backToDashboardBtn: document.getElementById('back-to-dashboard-btn'),
            
            // Flashcards
            flashcard: document.getElementById('flashcard'),
            flashcardTitle: document.getElementById('flashcard-title'),
            flashcardFrontContent: document.getElementById('flashcard-front-content'),
            flashcardBackContent: document.getElementById('flashcard-back-content'),
            prevFlashcardBtn: document.getElementById('prev-flashcard-btn'),
            flipFlashcardBtn: document.getElementById('flip-flashcard-btn'),
            nextFlashcardBtn: document.getElementById('next-flashcard-btn'),
            markEasyBtn: document.getElementById('mark-easy-btn'),
            markMediumBtn: document.getElementById('mark-medium-btn'),
            markHardBtn: document.getElementById('mark-hard-btn'),
            completeChapterBtn: document.getElementById('complete-chapter-btn'),
            
            // Quiz
            quizContainer: document.getElementById('quiz-container'),
            quizScore: document.getElementById('quiz-score'),
            scoreValue: document.getElementById('score-value'),
            submitQuizBtn: document.getElementById('submit-quiz-btn'),
            nextChapterBtn: document.getElementById('next-chapter-btn'),
            backToChaptersBtn: document.getElementById('back-to-chapters-btn'),
            
            // Profile View
            profileName: document.getElementById('profile-name'),
            profileKey: document.getElementById('profile-key'),
            profileCreated: document.getElementById('profile-created'),
            profileLanguage: document.getElementById('profile-language'),
            totalStudyTime: document.getElementById('total-study-time'),
            sessionsCompleted: document.getElementById('sessions-completed'),
            avgQuizScore: document.getElementById('avg-quiz-score'),
            currentStreak: document.getElementById('current-streak'),
            exportDataBtn: document.getElementById('export-data-btn'),
            resetProgressBtn: document.getElementById('reset-progress-btn'),
            backToDashboardFromProfileBtn: document.getElementById('back-to-dashboard-from-profile-btn'),
            
            // UI Elements
            profileToggle: document.getElementById('profile-toggle'),
            notification: document.getElementById('notification')
        };

        // Gemini API Configuration
        const GEMINI_API_ENDPOINT = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent';

        // Initialize Three.js Background
        function initThreeBackground() {
            const container = document.getElementById('three-background');
            
            // Scene
            const scene = new THREE.Scene();
            
            // Camera
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            
            // Renderer
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            container.appendChild(renderer.domElement);
            
            // Create floating particles
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 500;
            const posArray = new Float32Array(particlesCount * 3);
            
            for(let i = 0; i < particlesCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 10;
            }
            
            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            
            // Material
            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.02,
                color: 0xFF6B6B,
                transparent: true,
                opacity: 0.8
            });
            
            // Mesh
            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(particlesMesh);
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            // Animation
            function animate() {
                requestAnimationFrame(animate);
                
                particlesMesh.rotation.x += 0.001;
                particlesMesh.rotation.y += 0.002;
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // Initialize Application
        function initApp() {
            // Show splash screen first
            elements.continueToApp.addEventListener('click', () => {
                sections.splash.style.opacity = '0';
                setTimeout(() => {
                    sections.splash.style.display = 'none';
                    // Initialize Three.js background after splash screen
                    initThreeBackground();
                    
                    // Check if user has seen tutorial
                    const hasSeenTutorial = localStorage.getItem('hasSeenTutorial');
                    if (hasSeenTutorial) {
                        // Check for existing profile
                        const savedProfile = localStorage.getItem('userProfile');
                        if (savedProfile) {
                            loadUserProfile();
                            showSection('dashboard');
                        } else {
                            showSection('profile');
                        }
                    } else {
                        // First time user, show tutorial
                        showSection('tutorial');
                    }
                }, 1000);
            });

            // Event Listeners
            elements.gotItBtn.addEventListener('click', () => {
                localStorage.setItem('hasSeenTutorial', 'true');
                showSection('profile');
            });

            elements.showTutorialBtn.addEventListener('click', () => {
                showSection('tutorial');
            });
            
            // Profile Creation
            elements.createProfileBtn.addEventListener('click', createProfile);
            
            // Language Selection
            elements.languageCards.forEach(card => {
                card.addEventListener('click', () => {
                    // Remove selected class from all cards
                    elements.languageCards.forEach(c => c.classList.remove('selected'));
                    // Add selected class to clicked card
                    card.classList.add('selected');
                    // Update selected language
                    appState.selectedLanguage = card.dataset.language;
                });
            });
            
            elements.continueToApi.addEventListener('click', () => {
                showSection('apiKey');
            });
            
            // API Key Management
            elements.saveApiKeyBtn.addEventListener('click', saveApiKey);
            
            // Dashboard Navigation
            elements.continueLearningBtn.addEventListener('click', () => {
                startLearningSession();
            });
            
            elements.viewChaptersBtn.addEventListener('click', () => {
                showSection('chapters');
                renderChapters();
            });
            
            // Chapters Navigation
            elements.backToDashboardBtn.addEventListener('click', () => {
                showSection('dashboard');
            });
            
            // Flashcard Controls
            elements.prevFlashcardBtn.addEventListener('click', previousFlashcard);
            elements.flipFlashcardBtn.addEventListener('click', flipFlashcard);
            elements.nextFlashcardBtn.addEventListener('click', nextFlashcard);
            
            elements.markEasyBtn.addEventListener('click', () => markDifficulty('easy'));
            elements.markMediumBtn.addEventListener('click', () => markDifficulty('medium'));
            elements.markHardBtn.addEventListener('click', () => markDifficulty('hard'));
            
            elements.completeChapterBtn.addEventListener('click', completeChapter);
            
            // Quiz Controls
            elements.submitQuizBtn.addEventListener('click', submitQuiz);
            elements.nextChapterBtn.addEventListener('click', nextChapter);
            elements.backToChaptersBtn.addEventListener('click', () => {
                showSection('chapters');
            });
            
            // Profile View Controls
            elements.profileToggle.addEventListener('click', () => {
                showSection('profileView');
                updateProfileView();
            });
            
            elements.backToDashboardFromProfileBtn.addEventListener('click', () => {
                showSection('dashboard');
            });
            
            elements.exportDataBtn.addEventListener('click', exportLearningData);
            elements.resetProgressBtn.addEventListener('click', resetProgress);
            
            // Flashcard flip event
            elements.flashcard.addEventListener('click', flipFlashcard);
        }

        // Section Navigation
        function showSection(sectionName) {
            Object.values(sections).forEach(section => {
                section.classList.remove('active');
            });
            sections[sectionName].classList.add('active');
            appState.currentSection = sectionName;
        }

        // Profile Creation
        function createProfile() {
            const userName = elements.userName.value.trim();
            if (!userName) {
                showNotification('Please enter your awesome name!', 'error');
                return;
            }

            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            const userKey = `${userName}-${dateString}-12`;
            
            appState.userName = userName;
            appState.userKey = userKey;
            appState.createdDate = dateString;
            appState.learningGoal = elements.learningGoal.value;
            appState.sessionLength = parseInt(elements.sessionLength.value);
            
            // Save to localStorage
            const userProfile = {
                userName: appState.userName,
                userKey: appState.userKey,
                createdDate: appState.createdDate,
                learningGoal: appState.learningGoal,
                sessionLength: appState.sessionLength,
                selectedLanguage: appState.selectedLanguage,
                currentChapter: appState.currentChapter,
                completedChapters: appState.completedChapters,
                flashcardData: appState.flashcardData,
                quizScores: appState.quizScores,
                timeSpent: appState.timeSpent,
                learningPatterns: appState.learningPatterns,
                aiRecommendations: appState.aiRecommendations
            };
            
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            
            elements.profileStatus.textContent = 'Profile created successfully! üéâ';
            elements.profileStatus.style.color = '#4CAF50';
            
            // Show loading screen then proceed to language selection
            showSection('loading');
            setTimeout(() => {
                showSection('languageSelection');
            }, 2000);
        }

        // Load User Profile
        function loadUserProfile() {
            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                const profile = JSON.parse(savedProfile);
                appState.userName = profile.userName;
                appState.userKey = profile.userKey;
                appState.createdDate = profile.createdDate;
                appState.learningGoal = profile.learningGoal;
                appState.sessionLength = profile.sessionLength;
                appState.selectedLanguage = profile.selectedLanguage || 'java';
                appState.currentChapter = profile.currentChapter || 1;
                appState.completedChapters = profile.completedChapters || [];
                appState.flashcardData = profile.flashcardData || {};
                appState.quizScores = profile.quizScores || {};
                appState.timeSpent = profile.timeSpent || {};
                appState.learningPatterns = profile.learningPatterns || {
                    averageTimePerFlashcard: 0,
                    peakPerformanceTime: '',
                    difficultConcepts: [],
                    preferredLearningStyle: '',
                    retentionRate: 0,
                    commonMistakes: []
                };
                appState.aiRecommendations = profile.aiRecommendations || {
                    nextFocusAreas: [],
                    suggestedReviewTopics: [],
                    adaptedContent: false,
                    personalizedHints: false,
                    difficultyAdjustment: 0
                };
                
                // Load API key if available
                const savedApiKey = localStorage.getItem('geminiApiKey');
                if (savedApiKey) {
                    appState.apiKey = savedApiKey;
                }
                
                return true;
            }
            return false;
        }

        // Update Profile View
        function updateProfileView() {
            elements.profileName.textContent = appState.userName;
            elements.profileKey.textContent = appState.userKey;
            elements.profileCreated.textContent = appState.createdDate;
            elements.profileLanguage.textContent = languageContent[appState.selectedLanguage].name;
            
            // Calculate statistics
            const totalStudyTime = Object.values(appState.timeSpent).reduce((sum, time) => sum + time, 0);
            elements.totalStudyTime.textContent = `${totalStudyTime} minutes`;
            
            const sessionsCompleted = Object.keys(appState.timeSpent).length;
            elements.sessionsCompleted.textContent = sessionsCompleted;
            
            const quizScores = Object.values(appState.quizScores);
            const avgScore = quizScores.length > 0 ? 
                Math.round(quizScores.reduce((sum, score) => sum + score, 0) / quizScores.length) : 0;
            elements.avgQuizScore.textContent = `${avgScore}%`;
            
            // Calculate current streak (simplified)
            const today = new Date().toISOString().split('T')[0];
            const lastStudyDate = Object.keys(appState.timeSpent).sort().pop() || '';
            const currentStreak = lastStudyDate === today ? 1 : 0;
            elements.currentStreak.textContent = `${currentStreak} days`;
        }

        // API Key Management
        function saveApiKey() {
            const apiKey = elements.apiKeyInput.value.trim();
            if (!apiKey) {
                showNotification('Please enter your special AI magic key!', 'error');
                return;
            }

            // Simple validation - check if it looks like a Gemini API key
            if (!apiKey.startsWith('AIza') || apiKey.length < 20) {
                showNotification('That doesn\'t look like a magic key! Try again!', 'error');
                return;
            }

            appState.apiKey = apiKey;
            localStorage.setItem('geminiApiKey', apiKey);
            elements.apiStatus.textContent = 'AI key saved successfully! ü§ñ';
            elements.apiStatus.style.color = '#4CAF50';
            
            // Show loading screen then proceed to dashboard
            showSection('loading');
            setTimeout(() => {
                showSection('dashboard');
                updateDashboard();
            }, 3000);
        }

        // Update Dashboard
        function updateDashboard() {
            elements.userDisplayName.textContent = appState.userName;
            
            const currentChapterData = languageContent[appState.selectedLanguage].chapters.find(
                ch => ch.id === appState.currentChapter
            );
            elements.currentChapter.textContent = currentChapterData ? currentChapterData.title : 'Not started';
            
            elements.completedChapters.textContent = appState.completedChapters.length;
            
            // Calculate total flashcards (simplified)
            const totalFlashcards = Object.keys(appState.flashcardData).length;
            elements.totalFlashcards.textContent = totalFlashcards;
            
            // Calculate mastered concepts (simplified)
            const masteredConcepts = Object.values(appState.flashcardData).filter(
                card => card.correctAnswers >= 3
            ).length;
            elements.masteredConcepts.textContent = masteredConcepts;
            
            // Update learning patterns
            const avgTime = appState.learningPatterns.averageTimePerFlashcard;
            elements.avgTime.textContent = avgTime ? `${avgTime.toFixed(1)}s` : '-';
            
            elements.bestTime.textContent = appState.learningPatterns.peakPerformanceTime || '-';
            elements.retentionRate.textContent = appState.learningPatterns.retentionRate ? 
                `${(appState.learningPatterns.retentionRate * 100).toFixed(0)}%` : '-';
            
            const velocity = appState.learningPatterns.learningVelocity;
            elements.learningVelocity.textContent = velocity ? `${velocity.toFixed(1)}` : '-';
            
            // Update AI recommendations
            updateAIRecommendations();
        }

        // Update AI Recommendations
        function updateAIRecommendations() {
            if (!appState.apiKey) {
                elements.aiRecommendations.innerHTML = '<p>ü§ñ Connect your AI helper to get personalized tips!</p>';
                return;
            }
            
            // Generate recommendations based on learning patterns
            const recommendations = [];
            
            if (appState.learningPatterns.difficultConcepts.length > 0) {
                recommendations.push(`<p>üéØ Focus Areas: ${appState.learningPatterns.difficultConcepts.join(', ')}</p>`);
            }
            
            if (appState.aiRecommendations.suggestedReviewTopics.length > 0) {
                recommendations.push(`<p>üìö Review Topics: ${appState.aiRecommendations.suggestedReviewTopics.join(', ')}</p>`);
            }
            
            if (appState.learningPatterns.commonMistakes.length > 0) {
                recommendations.push(`<p>üîç Common Mistakes: ${appState.learningPatterns.commonMistakes.join(', ')}</p>`);
            }
            
            if (recommendations.length === 0) {
                recommendations.push('<p>üéÆ Complete more flashcards to get personalized tips from your AI friend!</p>');
            }
            
            elements.aiRecommendations.innerHTML = recommendations.join('');
        }

        // Render Chapters
        function renderChapters() {
            const chapters = languageContent[appState.selectedLanguage].chapters;
            
            elements.chapterGrid.innerHTML = chapters.map(chapter => {
                const isCompleted = appState.completedChapters.includes(chapter.id);
                const isCurrent = chapter.id === appState.currentChapter;
                
                let progress = 0;
                if (isCompleted) {
                    progress = 100;
                } else if (isCurrent) {
                    // Calculate progress for current chapter (simplified)
                    const chapterFlashcards = Object.keys(appState.flashcardData).filter(
                        key => key.startsWith(`ch${chapter.id}_`)
                    );
                    progress = chapterFlashcards.length > 0 ? 
                        Math.min(100, (chapterFlashcards.length / 10) * 100) : 0;
                }
                
                return `
                    <div class="chapter-card ${isCompleted ? 'completed' : ''} ${isCurrent ? 'current' : ''}" 
                         data-chapter-id="${chapter.id}">
                        <div class="chapter-title">${chapter.title}</div>
                        <div class="chapter-description">${chapter.description}</div>
                        <div class="chapter-progress">
                            <div class="chapter-progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="chapter-stats">
                            <span>${isCompleted ? 'Mission Complete! üèÜ' : isCurrent ? 'In Progress! üéÆ' : 'Not Started! üåü'}</span>
                            <span>${progress.toFixed(0)}%</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add event listeners to chapter cards
            const chapterCards = document.querySelectorAll('.chapter-card');
            chapterCards.forEach(card => {
                card.addEventListener('click', () => {
                    const chapterId = parseInt(card.dataset.chapterId);
                    startChapter(chapterId);
                });
            });
        }

        // Start Learning Session
        function startLearningSession() {
            appState.sessionStartTime = new Date();
            startChapter(appState.currentChapter);
        }

        // Start Chapter
        function startChapter(chapterId) {
            appState.currentChapter = chapterId;
            
            // Check if chapter is completed
            if (appState.completedChapters.includes(chapterId)) {
                showNotification('This mission is already completed! Starting review mode! üéÆ');
            }
            
            // Generate flashcards for the chapter
            generateChapterFlashcards(chapterId);
        }

        // Generate Chapter Flashcards
        async function generateChapterFlashcards(chapterId) {
            showSection('loading');
            
            const chapterData = languageContent[appState.selectedLanguage].chapters.find(
                ch => ch.id === chapterId
            );
            
            if (!chapterData) {
                showNotification('Mission not found! ü§î', 'error');
                showSection('chapters');
                return;
            }
            
            try {
                // Check if we have existing flashcards for this chapter
                const existingFlashcards = Object.keys(appState.flashcardData).filter(
                    key => key.startsWith(`ch${chapterId}_`)
                );
                
                if (existingFlashcards.length > 0) {
                    // Load existing flashcards
                    appState.currentFlashcards = existingFlashcards.map(key => {
                        return {
                            id: key,
                            ...appState.flashcardData[key]
                        };
                    });
                    
                    appState.currentFlashcardIndex = 0;
                    showSection('flashcard');
                    renderCurrentFlashcard();
                    return;
                }
                
                // Generate new flashcards using AI
                if (!appState.apiKey) {
                    showNotification('AI helper needed for creating flashcards! ü§ñ', 'error');
                    showSection('apiKey');
                    return;
                }
                
                const prompt = `Create 10 fun flashcards for a 10-year-old learning about "${chapterData.title}" in ${languageContent[appState.selectedLanguage].name}.
                
The chapter covers these topics:
 ${chapterData.topics.map(topic => `- ${topic}`).join('\n')}

IMPORTANT: Explain everything like you're talking to a 10-year-old child! Use simple language, fun analogies, and examples kids can understand.

For each flashcard, provide:
1. A fun question or concept on the front (simple language for kids)
2. A detailed answer or explanation on the back (explain like to a 10-year-old)
3. A simple code example if applicable (with comments explaining each part)
4. Difficulty level (easy, medium, or hard)

Return the response in valid JSON format exactly as shown below:
{
  "flashcards": [
    {
      "front": "Fun question or concept here (simple for kids)",
      "back": "Simple answer or explanation here (explain like to a 10-year-old)",
      "code": "Simple code example with comments (or empty string)",
      "difficulty": "easy|medium|hard"
    }
  ]
}

Do not include any text before or after the JSON. The response must be pure JSON that can be parsed by JSON.parse().`;
                
                const response = await callGeminiAPI(prompt);
                
                // Try to parse the JSON response
                let data;
                try {
                    // Clean the response
                    let cleanResponse = response.trim();
                    if (cleanResponse.startsWith('```json')) {
                        cleanResponse = cleanResponse.replace(/```json\n?/, '').replace(/\n?```$/, '');
                    } else if (cleanResponse.startsWith('```')) {
                        cleanResponse = cleanResponse.replace(/```\n?/, '').replace(/\n?```$/, '');
                    }
                    
                    // Try to find JSON object in the response
                    const jsonMatch = cleanResponse.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        cleanResponse = jsonMatch[0];
                    }
                    
                    data = JSON.parse(cleanResponse);
                    
                    if (!data.flashcards || !Array.isArray(data.flashcards)) {
                        throw new Error('Invalid JSON structure');
                    }
                    
                    // Validate each flashcard
                    data.flashcards = data.flashcards.filter(card => 
                        card.front && card.back && ['easy', 'medium', 'hard'].includes(card.difficulty)
                    );
                    
                    if (data.flashcards.length === 0) {
                        throw new Error('No valid flashcards found');
                    }
                } catch (parseError) {
                    console.error('Failed to parse AI response:', parseError);
                    showNotification('AI helper had a problem! Using backup flashcards! ü§ñ', 'error');
                    
                    // Use fallback flashcards
                    data = generateFallbackFlashcards(chapterData);
                }
                
                // Store flashcards in app state
                appState.currentFlashcards = data.flashcards.map((card, index) => {
                    const flashcardId = `ch${chapterId}_${index + 1}`;
                    const flashcardData = {
                        id: flashcardId,
                        front: card.front,
                        back: card.back,
                        code: card.code || '',
                        difficulty: card.difficulty,
                        firstViewTime: 0,
                        lastViewTime: 0,
                        viewCount: 0,
                        correctAnswers: 0,
                        userRating: card.difficulty
                    };
                    
                    // Store in flashcard data
                    appState.flashcardData[flashcardId] = flashcardData;
                    
                    return flashcardData;
                });
                
                appState.currentFlashcardIndex = 0;
                
                // Save to localStorage
                saveUserProfile();
                
                showSection('flashcard');
                renderCurrentFlashcard();
            } catch (error) {
                showNotification(`Error creating flashcards: ${error.message}`, 'error');
                showSection('chapters');
            }
        }

        // Generate Fallback Flashcards
        function generateFallbackFlashcards(chapterData) {
            const fallbackFlashcards = [];
            
            // Generate basic flashcards based on chapter topics
            chapterData.topics.forEach((topic, index) => {
                if (index < 10) { // Limit to 10 flashcards
                    fallbackFlashcards.push({
                        front: `What is ${topic}? ü§î`,
                        back: `${topic} is like a special tool in ${languageContent[appState.selectedLanguage].name} that helps you build amazing things! Think of it as a LEGO block for coding! üß±`,
                        code: '',
                        difficulty: 'medium'
                    });
                }
            });
            
            // Ensure we have at least 10 flashcards
            while (fallbackFlashcards.length < 10) {
                fallbackFlashcards.push({
                    front: `What are the key ideas in ${chapterData.title}? üåü`,
                    back: `The key ideas in ${chapterData.title} are like special superpowers that help you create awesome programs! Each one helps you organize your code better! ü¶∏‚Äç‚ôÇÔ∏è`,
                    code: '',
                    difficulty: 'medium'
                });
            }
            
            return { flashcards: fallbackFlashcards };
        }

        // Render Current Flashcard
        function renderCurrentFlashcard() {
            if (appState.currentFlashcards.length === 0) {
                showNotification('No flashcards available for this mission! ü§î', 'error');
                showSection('chapters');
                return;
            }
            
            const flashcard = appState.currentFlashcards[appState.currentFlashcardIndex];
            
            elements.flashcardTitle.textContent = `Flashcard ${appState.currentFlashcardIndex + 1} of ${appState.currentFlashcards.length} üé¥`;
            elements.flashcardFrontContent.innerHTML = `
                <div>${flashcard.front}</div>
                ${flashcard.code ? `<div class="flashcard-code">${flashcard.code}</div>` : ''}
            `;
            elements.flashcardBackContent.innerHTML = `
                <div>${flashcard.back}</div>
                ${flashcard.code ? `<div class="flashcard-code">${flashcard.code}</div>` : ''}
            `;
            
            // Reset flip state
            elements.flashcard.classList.remove('flipped');
            
            // Update difficulty indicator
            updateDifficultyIndicator(flashcard.userRating);
            
            // Update button states
            elements.prevFlashcardBtn.disabled = appState.currentFlashcardIndex === 0;
            elements.nextFlashcardBtn.disabled = appState.currentFlashcardIndex === appState.currentFlashcards.length - 1;
            
            // Record view time
            const viewStartTime = new Date();
            
            // Update flashcard data when navigating away
            const updateViewData = () => {
                const viewEndTime = new Date();
                const viewTime = (viewEndTime - viewStartTime) / 1000; // in seconds
                
                if (!flashcard.firstViewTime) {
                    flashcard.firstViewTime = viewTime;
                }
                flashcard.lastViewTime = viewTime;
                flashcard.viewCount++;
                
                // Save to app state
                appState.flashcardData[flashcard.id] = flashcard;
                
                // Update learning patterns
                updateLearningPatterns();
            };
            
            // Store update function for later use
            elements.flashcard.updateViewData = updateViewData;
        }

        // Update Difficulty Indicator
        function updateDifficultyIndicator(difficulty) {
            const dots = document.querySelectorAll('.difficulty-dot');
            dots.forEach(dot => dot.style.opacity = '0.3');
            
            if (difficulty === 'easy') {
                dots[0].style.opacity = '1';
            } else if (difficulty === 'medium') {
                dots[1].style.opacity = '1';
            } else if (difficulty === 'hard') {
                dots[2].style.opacity = '1';
            }
        }

        // Flashcard Navigation
        function previousFlashcard() {
            if (elements.flashcard.updateViewData) {
                elements.flashcard.updateViewData();
            }
            
            if (appState.currentFlashcardIndex > 0) {
                appState.currentFlashcardIndex--;
                renderCurrentFlashcard();
            }
        }

        function nextFlashcard() {
            if (elements.flashcard.updateViewData) {
                elements.flashcard.updateViewData();
            }
            
            if (appState.currentFlashcardIndex < appState.currentFlashcards.length - 1) {
                appState.currentFlashcardIndex++;
                renderCurrentFlashcard();
            }
        }

        function flipFlashcard() {
            elements.flashcard.classList.toggle('flipped');
        }

        // Mark Difficulty
        function markDifficulty(difficulty) {
            const flashcard = appState.currentFlashcards[appState.currentFlashcardIndex];
            flashcard.userRating = difficulty;
            
            // Update in app state
            appState.flashcardData[flashcard.id] = flashcard;
            
            // Update difficulty indicator
            updateDifficultyIndicator(difficulty);
            
            // Save to localStorage
            saveUserProfile();
            
            const messages = {
                easy: 'Too easy! You\'re a super coder! üòé',
                medium: 'Just right! Keep going! üòä',
                hard: 'A bit tricky! You\'ll get it! ü§î'
            };
            
            showNotification(messages[difficulty]);
        }

        // Complete Chapter
        function completeChapter() {
            if (elements.flashcard.updateViewData) {
                elements.flashcard.updateViewData();
            }
            
            // Generate quiz for the chapter
            generateChapterQuiz();
        }

        // Generate Chapter Quiz
        async function generateChapterQuiz() {
            showSection('loading');
            
            const chapterData = languageContent[appState.selectedLanguage].chapters.find(
                ch => ch.id === appState.currentChapter
            );
            
            if (!chapterData) {
                showNotification('Mission not found! ü§î', 'error');
                showSection('flashcard');
                return;
            }
            
            try {
                if (!appState.apiKey) {
                    showNotification('AI helper needed for creating quiz! ü§ñ', 'error');
                    showSection('apiKey');
                    return;
                }
                
                const prompt = `Create a fun 5-question quiz for a 10-year-old learning about "${chapterData.title}" in ${languageContent[appState.selectedLanguage].name}.
                
The chapter covers these topics:
 ${chapterData.topics.map(topic => `- ${topic}`).join('\n')}

IMPORTANT: Make this quiz fun and engaging for a 10-year-old! Use simple language and relatable examples.

For each question, provide:
1. A fun question text (simple for kids)
2. 4 multiple choice options (A, B, C, D) - make them fun and engaging
3. The correct answer (A, B, C, or D)
4. A brief explanation of why the answer is correct (explain like to a 10-year-old)

Focus on testing understanding of the key concepts in a fun way. Include a mix of conceptual questions and practical examples kids can relate to.

Return the response in valid JSON format exactly as shown below:
{
  "questions": [
    {
      "question": "Fun question text here (simple for kids)",
      "options": ["Fun Option A", "Fun Option B", "Fun Option C", "Fun Option D"],
      "correct": "A",
      "explanation": "Simple explanation here (explain like to a 10-year-old)"
    }
  ]
}

Do not include any text before or after the JSON. The response must be pure JSON that can be parsed by JSON.parse().`;
                
                const response = await callGeminiAPI(prompt);
                
                // Try to parse the JSON response
                let data;
                try {
                    // Clean the response
                    let cleanResponse = response.trim();
                    if (cleanResponse.startsWith('```json')) {
                        cleanResponse = cleanResponse.replace(/```json\n?/, '').replace(/\n?```$/, '');
                    } else if (cleanResponse.startsWith('```')) {
                        cleanResponse = cleanResponse.replace(/```\n?/, '').replace(/\n?```$/, '');
                    }
                    
                    // Try to find JSON object in the response
                    const jsonMatch = cleanResponse.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        cleanResponse = jsonMatch[0];
                    }
                    
                    data = JSON.parse(cleanResponse);
                    
                    if (!data.questions || !Array.isArray(data.questions)) {
                        throw new Error('Invalid JSON structure');
                    }
                    
                    // Validate each question
                    data.questions = data.questions.filter(q => 
                        q.question && q.options && q.options.length === 4 && 
                        ['A', 'B', 'C', 'D'].includes(q.correct) && q.explanation
                    );
                    
                    if (data.questions.length === 0) {
                        throw new Error('No valid questions found');
                    }
                } catch (parseError) {
                    console.error('Failed to parse AI response:', parseError);
                    showNotification('AI helper had a problem! Using backup quiz! ü§ñ', 'error');
                    
                    // Use fallback quiz
                    data = generateFallbackQuiz(chapterData);
                }
                
                // Store quiz in app state
                appState.currentQuiz = data.questions;
                appState.currentQuizAnswers = new Array(data.questions.length).fill(null);
                
                showSection('quiz');
                renderCurrentQuizQuestion();
            } catch (error) {
                showNotification(`Error creating quiz: ${error.message}`, 'error');
                showSection('flashcard');
            }
        }

        // Generate Fallback Quiz
        function generateFallbackQuiz(chapterData) {
            const fallbackQuestions = [];
            
            // Generate basic questions based on chapter topics
            for (let i = 0; i < 5; i++) {
                const topic = chapterData.topics[i % chapterData.topics.length];
                fallbackQuestions.push({
                    question: `What is ${topic} like in real life? ü§î`,
                    options: [
                        "Like building with LEGOs! üß±",
                        "Like playing video games! üéÆ",
                        "Like eating pizza! üçï",
                        "Like riding a bike! üö≤"
                    ],
                    correct: "A",
                    explanation: `${topic} is like building with LEGOs - you use different pieces to create something amazing! üß±`
                });
            }
            
            return { questions: fallbackQuestions };
        }

        // Render Current Quiz Question
        function renderCurrentQuizQuestion() {
            if (appState.currentQuiz.length === 0) {
                showNotification('No quiz questions available! ü§î', 'error');
                showSection('flashcard');
                return;
            }
            
            const currentQuestionIndex = appState.currentQuizAnswers.findIndex(
                answer => answer === null
            );
            
            if (currentQuestionIndex === -1) {
                // All questions answered
                showQuizResults();
                return;
            }
            
            const question = appState.currentQuiz[currentQuestionIndex];
            
            elements.quizContainer.innerHTML = `
                <div class="quiz-container">
                    <div class="quiz-question">Question ${currentQuestionIndex + 1} of ${appState.currentQuiz.length}: ${question.question}</div>
                    <div class="quiz-options">
                        ${question.options.map((option, index) => {
                            const letter = String.fromCharCode(65 + index); // A, B, C, D
                            const isSelected = appState.currentQuizAnswers[currentQuestionIndex] === letter;
                            return `
                                <div class="quiz-option ${isSelected ? 'selected' : ''}" data-answer="${letter}">
                                    ${letter}. ${option}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            // Add event listeners to options
            const quizOptions = document.querySelectorAll('.quiz-option');
            quizOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    quizOptions.forEach(opt => opt.classList.remove('selected'));
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    // Store the answer
                    const answer = option.dataset.answer;
                    appState.currentQuizAnswers[currentQuestionIndex] = answer;
                });
            });
            
            // Show submit button if all questions are answered
            const allAnswered = appState.currentQuizAnswers.every(answer => answer !== null);
            elements.submitQuizBtn.style.display = allAnswered ? 'inline-block' : 'none';
        }

        // Submit Quiz
        function submitQuiz() {
            // Calculate score
            let correctCount = 0;
            const questionResults = [];
            
            appState.currentQuiz.forEach((question, index) => {
                const userAnswer = appState.currentQuizAnswers[index];
                const isCorrect = userAnswer === question.correct;
                
                if (isCorrect) {
                    correctCount++;
                }
                
                questionResults.push({
                    question: question.question,
                    userAnswer: userAnswer,
                    correctAnswer: question.correct,
                    isCorrect: isCorrect,
                    explanation: question.explanation
                });
            });
            
            const score = Math.round((correctCount / appState.currentQuiz.length) * 100);
            
            // Store quiz score
            appState.quizScores[`ch${appState.currentChapter}`] = score;
            
            // Save to localStorage
            saveUserProfile();
            
            // Show results
            showQuizResults(questionResults, score);
        }

        // Show Quiz Results
        function showQuizResults(questionResults, score) {
            if (!questionResults) {
                // Calculate score if not provided
                let correctCount = 0;
                questionResults = [];
                
                appState.currentQuiz.forEach((question, index) => {
                    const userAnswer = appState.currentQuizAnswers[index];
                    const isCorrect = userAnswer === question.correct;
                    
                    if (isCorrect) {
                        correctCount++;
                    }
                    
                    questionResults.push({
                        question: question.question,
                        userAnswer: userAnswer,
                        correctAnswer: question.correct,
                        isCorrect: isCorrect,
                        explanation: question.explanation
                    });
                });
                
                score = Math.round((correctCount / appState.currentQuiz.length) * 100);
            }
            
            // Display results
            elements.quizContainer.innerHTML = questionResults.map((result, index) => `
                <div class="quiz-container">
                    <div class="quiz-question">Question ${index + 1}: ${result.question}</div>
                    <div class="quiz-options">
                        ${appState.currentQuiz[index].options.map((option, optionIndex) => {
                            const letter = String.fromCharCode(65 + optionIndex);
                            const isUserAnswer = letter === result.userAnswer;
                            const isCorrectAnswer = letter === result.correctAnswer;
                            
                            let className = 'quiz-option';
                            if (isCorrectAnswer) {
                                className += ' correct';
                            } else if (isUserAnswer) {
                                className += ' incorrect';
                            }
                            
                            return `
                                <div class="${className}">
                                    ${letter}. ${option}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    ${!result.isCorrect ? `
                        <div class="quiz-feedback">
                            <strong>Fun Fact:</strong> ${result.explanation}
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            elements.quizScore.style.display = 'block';
            elements.scoreValue.textContent = score;
            
            // Show next chapter button if score is good enough
            if (score >= 70) {
                elements.nextChapterBtn.style.display = 'inline-block';
                
                // Mark chapter as completed
                if (!appState.completedChapters.includes(appState.currentChapter)) {
                    appState.completedChapters.push(appState.currentChapter);
                    saveUserProfile();
                }
                
                // Show achievement message
                if (score >= 90) {
                    showNotification('Amazing job! You\'re a coding superstar! ‚≠êüåü‚≠ê', 'success');
                } else {
                    showNotification('Great work! Mission completed! üéâ', 'success');
                }
            } else {
                elements.nextChapterBtn.style.display = 'none';
                showNotification('You need to score at least 70% to unlock the next mission. Try again! üí™', 'error');
            }
            
            elements.submitQuizBtn.style.display = 'none';
        }

        // Next Chapter
        function nextChapter() {
            const chapters = languageContent[appState.selectedLanguage].chapters;
            const currentChapterIndex = chapters.findIndex(ch => ch.id === appState.currentChapter);
            
            if (currentChapterIndex < chapters.length - 1) {
                appState.currentChapter = chapters[currentChapterIndex + 1].id;
                startChapter(appState.currentChapter);
            } else {
                showNotification('Congratulations! You\'ve completed all missions! You\'re a coding hero! ü¶∏‚Äç‚ôÇÔ∏èüéâ', 'success');
                showSection('dashboard');
                updateDashboard();
            }
        }

        // Update Learning Patterns
        function updateLearningPatterns() {
            const flashcards = Object.values(appState.flashcardData);
            
            if (flashcards.length === 0) return;
            
            // Calculate average time per flashcard
            const totalTime = flashcards.reduce((sum, card) => sum + (card.lastViewTime || 0), 0);
            appState.learningPatterns.averageTimePerFlashcard = totalTime / flashcards.length;
            
            // Determine peak performance time (simplified)
            const hour = new Date().getHours();
            if (hour >= 9 && hour <= 11) {
                appState.learningPatterns.peakPerformanceTime = 'morning';
            } else if (hour >= 14 && hour <= 16) {
                appState.learningPatterns.peakPerformanceTime = 'afternoon';
            } else if (hour >= 19 && hour <= 21) {
                appState.learningPatterns.peakPerformanceTime = 'evening';
            } else {
                appState.learningPatterns.peakPerformanceTime = 'other';
            }
            
            // Identify difficult concepts (cards marked as hard)
            appState.learningPatterns.difficultConcepts = flashcards
                .filter(card => card.userRating === 'hard')
                .map(card => card.front.substring(0, 30) + '...');
            
            // Calculate retention rate (simplified)
            const viewedCards = flashcards.filter(card => card.viewCount > 1);
            if (viewedCards.length > 0) {
                const correctCards = viewedCards.filter(card => card.correctAnswers >= card.viewCount * 0.7);
                appState.learningPatterns.retentionRate = correctCards.length / viewedCards.length;
            }
            
            // Calculate learning velocity (simplified)
            const today = new Date().toISOString().split('T')[0];
            const todayCards = flashcards.filter(card => 
                card.lastViewTime && new Date(card.lastViewTime).toISOString().split('T')[0] === today
            );
            appState.learningPatterns.learningVelocity = todayCards.length;
            
            // Update AI recommendations based on patterns
            updateAIRecommendationsBasedOnPatterns();
        }

        // Update AI Recommendations Based on Patterns
        function updateAIRecommendationsBasedOnPatterns() {
            // Focus on difficult concepts
            appState.aiRecommendations.nextFocusAreas = appState.learningPatterns.difficultConcepts.slice(0, 3);
            
            // Suggest review topics based on retention rate
            const lowRetentionCards = Object.values(appState.flashcardData).filter(card => 
                card.viewCount > 1 && (card.correctAnswers / card.viewCount) < 0.7
            );
            appState.aiRecommendations.suggestedReviewTopics = lowRetentionCards
                .map(card => card.front.substring(0, 30) + '...')
                .slice(0, 3);
            
            // Mark content as adapted if we have enough data
            appState.aiRecommendations.adaptedContent = Object.keys(appState.flashcardData).length > 20;
            
            // Enable personalized hints if user has struggled with concepts
            appState.aiRecommendations.personalizedHints = appState.learningPatterns.difficultConcepts.length > 0;
            
            // Adjust difficulty based on performance
            const avgScore = Object.values(appState.quizScores).reduce((sum, score) => sum + score, 0) / 
                             Object.keys(appState.quizScores).length;
            
            if (avgScore < 60) {
                appState.aiRecommendations.difficultyAdjustment = -0.2; // Make easier
            } else if (avgScore > 85) {
                appState.aiRecommendations.difficultyAdjustment = 0.2; // Make harder
            } else {
                appState.aiRecommendations.difficultyAdjustment = 0; // Keep same
            }
        }

        // Gemini API Call Function
        async function callGeminiAPI(prompt) {
            try {
                const response = await fetch(GEMINI_API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-goog-api-key': appState.apiKey
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    {
                                        text: prompt
                                    }
                                ]
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'API request failed');
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error('Gemini API Error:', error);
                throw error;
            }
        }

        // Save User Profile to LocalStorage
        function saveUserProfile() {
            const userProfile = {
                userName: appState.userName,
                userKey: appState.userKey,
                createdDate: appState.createdDate,
                learningGoal: appState.learningGoal,
                sessionLength: appState.sessionLength,
                selectedLanguage: appState.selectedLanguage,
                currentChapter: appState.currentChapter,
                completedChapters: appState.completedChapters,
                flashcardData: appState.flashcardData,
                quizScores: appState.quizScores,
                timeSpent: appState.timeSpent,
                learningPatterns: appState.learningPatterns,
                aiRecommendations: appState.aiRecommendations
            };
            
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
        }

        // Export Learning Data
        function exportLearningData() {
            const userProfile = {
                userName: appState.userName,
                userKey: appState.userKey,
                createdDate: appState.createdDate,
                learningGoal: appState.learningGoal,
                selectedLanguage: appState.selectedLanguage,
                currentChapter: appState.currentChapter,
                completedChapters: appState.completedChapters,
                flashcardData: appState.flashcardData,
                quizScores: appState.quizScores,
                timeSpent: appState.timeSpent,
                learningPatterns: appState.learningPatterns,
                aiRecommendations: appState.aiRecommendations
            };
            
            const dataStr = JSON.stringify(userProfile, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `codekids-data-${appState.userName}-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Learning data saved successfully! üíæ');
        }

        // Reset Progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all your progress? This will start your adventure over! üîÑ')) {
                // Reset progress but keep profile info
                appState.currentChapter = 1;
                appState.completedChapters = [];
                appState.flashcardData = {};
                appState.quizScores = {};
                appState.timeSpent = {};
                appState.learningPatterns = {
                    averageTimePerFlashcard: 0,
                    peakPerformanceTime: '',
                    difficultConcepts: [],
                    preferredLearningStyle: '',
                    retentionRate: 0,
                    commonMistakes: []
                };
                appState.aiRecommendations = {
                    nextFocusAreas: [],
                    suggestedReviewTopics: [],
                    adaptedContent: false,
                    personalizedHints: false,
                    difficultyAdjustment: 0
                };
                
                // Save to localStorage
                saveUserProfile();
                
                showNotification('Adventure reset! Ready to start fresh! üåü');
                showSection('dashboard');
                updateDashboard();
            }
        }

        // Utility Functions
        function showNotification(message, type = 'success') {
            elements.notification.textContent = message;
            elements.notification.className = `notification ${type}`;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>